package today.sleek.client.modules.impl.exploit

import today.sleek.base.modules.ModuleData
import today.sleek.base.modules.ModuleCategory
import today.sleek.base.value.value.NumberValue
import java.util.HashMap
import today.sleek.client.utils.server.ServerUtil
import com.google.common.eventbus.Subscribe
import net.minecraft.network.Packet
import today.sleek.base.event.impl.PacketEvent
import today.sleek.base.event.PacketDirection
import net.minecraft.network.play.server.S02PacketChat
import today.sleek.client.modules.impl.Module
import today.sleek.client.utils.chat.ChatUtil

@ModuleData(name = "AC Detector", category = ModuleCategory.EXPLOIT, description = "Detects anticheats")
class ACDetector : Module("ACDetector", ModuleCategory.EXPLOIT) {
    private val speed = NumberValue("Delay", this, 1.0, 0.1, 5.0, 0.1)
    private val servers = HashMap<String, String>()

    override fun onEnable() {
        for (srv in servers.keys) {
            if (ServerUtil.onServer(srv)) {
                ChatUtil.log("§fThis server seems to use §b${servers.get(srv)} §fas their anticheat.")
                toggle()
            }
        }
    }

    @Subscribe
    fun onPacket(event: PacketEvent) {
        if (event.packetDirection != PacketDirection.INBOUND) {
            return
        }
        if (event.getPacket<Packet<*>>() !is S02PacketChat) {
            return
        }
        val chat = event.getPacket<S02PacketChat>()
        val msg = chat.getChatComponent().formattedText
    }

    init {
        register(speed)

        servers["blocksmc.net"] = "Modified Verus"
        servers["holypvp.net"] = "Verus"
        servers["minemen.club"] = "AntiGamingChair"
    }
}