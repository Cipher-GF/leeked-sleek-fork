package today.sleek.client.modules.impl.exploit

import today.sleek.base.modules.ModuleData
import today.sleek.base.modules.ModuleCategory
import com.google.common.eventbus.Subscribe
import net.minecraft.network.Packet
import today.sleek.base.event.impl.PacketEvent
import net.minecraft.network.play.client.C01PacketChatMessage
import org.apache.commons.lang3.RandomUtils
import today.sleek.client.modules.impl.Module
import today.sleek.client.utils.network.PacketUtil
import java.lang.StringBuilder

@ModuleData(name = "Chat Bypass", category = ModuleCategory.EXPLOIT, description = "Detects anti filters")
class FilterBypass : Module() {

    @Subscribe
    fun onPacket(event: PacketEvent) {
        if (event.getPacket<Packet<*>>() is C01PacketChatMessage) {
            val msg = (event.getPacket<Packet<*>>() as C01PacketChatMessage).message
            if (msg.startsWith("/")) return

            //split the msg to a char array
            val splitString = msg.toCharArray()
            val b = StringBuilder()

            //loop through them
            for (c in splitString) {
                //add an invisible character randomly
                if (RandomUtils.nextInt(0, 4) == 0) {
                    b.append("\u061C")
                }
                b.append(c)
            }

            //cancel
            event.isCancelled = true

            //send the packet
            PacketUtil.sendPacketNoEvent(C01PacketChatMessage(b.toString()))
        }
    }
}